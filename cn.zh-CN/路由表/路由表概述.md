# 路由表概述 {#concept_qbk_bvn_4gb .concept}

创建专有网络后，系统会自动为您创建一张默认路由表并为其添加系统路由来管理专有网络的流量。您不能创建系统路由，也不能删除系统路由，但您可以创建自定义路由，将指定目标网段的流量路由至指定的目的地。

## 路由表 {#section_rmh_4nb_r2b .section}

创建专有网络后，系统会默认创建一个路由表控制专有网络的路由，所有专有网络内的交换机默认使用该路由表。您不能创建也不能删除默认路由表，但您可以在专有网络内创建自定义路由表，然后将其和交换机绑定来控制子网路由，更灵活地进行网络管理。详细信息，请参见[创建自定义路由表](cn.zh-CN/路由表/管理自定义路由表/创建自定义路由表.md#)。

路由表中的每一项是一条路由条目。路由条目指定了网络流量的导向目的地，由目标网段、下一跳类型、下一跳三部分组成。路由条目包括系统路由和自定义路由。

在管理路由表时，注意：

-   每个专有网络最多可以有10张路由表，包括系统路由表。
-   每个交换机只能绑定一张路由表。交换机（子网）的路由策略由其关联的路由表管理。
-   交换机创建后，该交换机默认与系统路由表绑定。
-   如果您需要将交换机绑定的自定义路由表更换成系统路由表，直接将自定义路由表与交换机解绑即可。如果您需要绑定其他路由表，需要先将交换机与当前路由表解绑，再绑定指定的自定义路由表。
-   目前，除华北2（北京）、华南1（深圳）和华东1（杭州）外所有地域都已支持自定义路由表。
-   自定义路由表不支持主备路由和负载路由。

## 系统路由 {#section_hcs_tly_rdb .section}

创建专有网络后，系统会在路由表中自动添加如下系统路由：

-   以100.64.0.0/10为目标网段的路由条目，用于VPC内的云产品通信。
-   以交换机网段为目标网段的路由条目，用于交换机内的云产品通信。

例如您创建了一个网段为192.168.0.0/16的专有网络，并在该专有网络下创建了两个网段为192.168.1.0/24和192.168.0.0/24的交换机，则该专有网络的路由表中会有如下三条系统路由：

|目标网段|下一跳|类型|
|:---|:--|:-|
|100.64.0.0/10|-|系统路由|
|192.168.1.0/24|-|系统路由|
|192.168.0.0/24|-|系统路由|

## 自定义路由 {#section_d44_4my_rdb .section}

您可以添加自定义路由来替换系统路由或将目标流量路由到指定的目的地。在添加自定义路由时，您可以指定以下下一跳类型：

-   ECS实例：将指向目标网段的流量转发到专有网络内的一台ECS实例。

    当需要通过该ECS实例部署的应用访问互联网或其他应用时，配置此类型的路由。

-   VPN网关：将指向目标网段的流量转发到一个VPN网关。

    当需要通过VPN网关连接本地网络或者其他专有网络时，配置此类型的路由。

-   NAT网关：将指向目标网段的流量转发到一个NAT网关。

    当需要通过NAT网关连接互联网时，配置此类型的路由。

-   路由器接口（专有网络方向）：将指向目标网段的流量转发到一个专有网络内。

    当需要使用高速通道连接两个专有网络时，配置此类型的路由。

-   路由器接口（边界路由器方向）：将指向目标网段的流量转发到一个边界路由器。

    当需要使用高速通道连接本地网络（物理专线接入）时，配置此类型的路由。

-   辅助弹性网卡：将指向目标网段的流量转发到指定的辅助弹性网卡。
-   IPv6网关：将指向目标网段的流量转发到一个IPv6网关。

    当需要通过IPv6网关进行IPv6通信时，配置此类型的路由。


## IPv6路由 {#section_efr_nys_dgb .section}

如果您的VPC开通了IPv6。VPC的系统路由表中会自动添加以下路由条目：

-   以::/0为目标网段，下一跳为IPv6网关实例的自定义路由条目，用于VPC内云产品经IPv6地址与互联网通信。
-   以交换机IPv6网段为目标网段的系统路由条目，用于交换机内的云产品通信。

    **说明：** 如果您创建了自定义路由表，并且绑定了开通了IPv6网段的交换机，您需要手动添加一条以::/0为目标网段，下一跳为IPv6网关实例的自定义路由条目。详细信息，请参见[添加自定义路由条目](cn.zh-CN/路由表/管理自定义路由表/添加自定义路由条目.md#)。


## 选路规则 {#section_dq3_3ny_rdb .section}

路由表采用最长前缀匹配原则作为流量的路由选路规则。最长前缀匹配是指当路由表中有多条路由条目可以匹配目的IP时，采用掩码最长（最精确）的一条路由作为匹配项并确定下一跳。

例如下表为某专有网络的路由表。

|目标网段|下一跳类型|下一跳|路由条目类型|
|:---|:----|:--|:-----|
|100.64.0.0/10|-|-|系统|
|192.168.0.0/24|-|-|系统|
|0.0.0.0/0|Instance|i-12345678|自定义|
|10.0.0.0/24|Instance|i-87654321|自定义|

目标网段为`100.64.0.0/10`和`192.168.0.0/24`的两条路由均为系统路由。目标网段为`0.0.0.0/0`和`10.0.0.0/24`的两条路由为自定义路由，表示将访问`0.0.0.0/0`地址段的流量转发至ID为`i-12345678`的ECS实例，将访问`10.0.0.0/24`地址段的流量转发至ID为`i-87654321`的ECS实例。根据最长前缀匹配规则，在该专有网络中，访问`10.0.0.1`的流量会转发至`i-87654321`，而访问`10.0.1.1`的流量会转发至`i-12345678`。

## 路由示例 {#section_eh3_vny_rdb .section}

您可以通过在路由表中添加自定义路由条目控制专有网络的出入流量。

-   VPC内网路由

    如下图所示，当您在VPC内的一台ECS实例（ECS01）自建了NAT网关，专有网络内的云资源需要通过该ECS实例访问公网时，可以添加如下一条自定义路由：

    |目标网段|下一跳类型|下一跳|
    |:---|:----|:--|
    |0.0.0.0/0|ECS实例|ECS01|

    ![VPC内网路由](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/2437/1566310983810_zh-CN.png)

-   VPC互通（高速通道）

    如下图所示，当使用高速通道连接两个VPC（VPC1 172.16.0.0/12和VPC2 192.168.0.0/16）时，创建完两个互相连接的路由器接口后，您还需要在两个VPC中分别添加如下一条路由：

    -   VPC1的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |192.168.0.0/16|路由器接口（专有网络方向）|VPC2|

    -   VPC2的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |172.16.0.0/12|路由器接口（专有网络方向）|VPC1|

        ![VPC互通（高速通道）](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/2437/1566310983811_zh-CN.png)


-   VPC互通（VPN网关）

    如下图所示，当使用VPN网关连接两个VPC（VPC1 172.16.0.0/12和VPC2 10.0.0.0/8）时，配置完VPN网关后，需要在VPC中分别添加如下路由：

    -   VPC1的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |10.0.0.0/8|VPN网关|VPN网关1|

    -   VPC2的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |172.16.0.0/12|VPN网关|VPN网关2|

        ![VPC互通（VPN网关）](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/49002/cn_zh/1515580691775/VPN2VPC.png)

-   连接本地IDC（高速通道）

    如下图所示，当使用高速通道物理专线连接专有网络和本地网络时，配置完专线和边界路由器后，需要配置如下路由：

    -   VPC端的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |192.168.0.0/16|路由器接口（普通路由）|路由器接口RI1|

    -   边界路由器的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |192.168.0.0/16|指向专线|路由器接口RI3|
        |172.16.0.0/12|指向VPC|路由器接口RI2|

    -   本地网络的路由配置

        |目标网段|下一跳类型|下一跳|
        |:---|:----|:--|
        |172.16.0.0/12|—|本地网关设备|

        ![连接本地IDC（高速通道）](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/2437/15663109836425_zh-CN.png)

-   连接本地IDC（VPN网关）

    如下图所示，当使用VPN网关连接VPC（网段：172.16.0.0/12）和本地网络（网段：192.168.0.0/16）时，配置好VPN网关后，需要在VPC内添加如下一条路由：

    |目标网段|下一跳类型|下一跳|
    |:---|:----|:--|
    |192.168.0.0/16|VPN网关|已创建的VPN网关|

    ![连接本地IDC（VPN网关）](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/2437/1566310984814_zh-CN.png)


